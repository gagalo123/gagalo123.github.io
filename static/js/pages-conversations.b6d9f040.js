(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-conversations"],{"0d65":function(t,e,n){"use strict";n("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.formatDate=function(t){t=t||Date.now();var e=new Date(t),n=e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1;return n+="-",n+=e.getDate()<10?"0"+e.getDate():e.getDate(),n+=" ",n+=e.getHours(),n+=":",n+=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),n},e.formateTime=function(t){var e=(new Date).getTime(),n=e-t,i=n/1e3,o=n/6e4,a=n/36e5,s=n/864e5;return s>=1?parseInt(s)+"天":a>=1?parseInt(a)+"小时":o>=1?parseInt(o)+"分钟":i>=1?parseInt(i)+"秒":"0秒"},n("e966")},"1f7e":function(t,e,n){var i=n("c86c"),o=n("2ec5"),a=n("4447");e=i(!1);var s=o(a);e.push([t.i,"uni-page-body[data-v-4b25e1c0]{height:100%}.conversations[data-v-4b25e1c0]{width:%?750?%;overflow-x:hidden;display:flex;flex-direction:column;box-sizing:border-box;height:100%}.conversations .scroll-item[data-v-4b25e1c0]{height:%?152?%;display:flex;align-items:center;padding-left:%?20?%}.conversations .scroll-item .head-icon[data-v-4b25e1c0]{width:%?100?%;height:%?100?%;margin-right:%?28?%}.conversations .scroll-item_info[data-v-4b25e1c0]{height:%?151?%;width:%?590?%;padding-right:%?22?%;border-bottom:1px solid #efefef}.conversations .scroll-item_info .item-info-top[data-v-4b25e1c0]{padding-top:%?20?%;height:%?60?%;line-height:%?60?%;display:flex;align-items:center;justify-content:space-between}.conversations .item-info-top_name[data-v-4b25e1c0]{font-size:%?34?%;color:#262628}.conversations .item-info-top_time[data-v-4b25e1c0]{font-size:%?34?%;color:hsla(0,0%,70.2%,.8);font-family:Source Han Sans CN}.conversations .item-info-bottom[data-v-4b25e1c0]{height:%?40?%;line-height:%?40?%;overflow:hidden}.conversations .item-info-bottom-item[data-v-4b25e1c0]{display:flex;justify-content:space-between}.item-info-bottom .item-info-top_content[data-v-4b25e1c0]{font-size:%?34?%;color:#b3b3b3;width:%?520?%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.item-info-bottom .item-info-bottom_action[data-v-4b25e1c0]{width:%?70?%;height:%?70?%;font-size:%?34?%;background:url("+s+") no-repeat 50%;background-size:%?28?% %?30?%}.no-conversation[data-v-4b25e1c0]{width:100%;text-align:center;height:%?80?%;line-height:%?80?%;font-size:%?34?%;color:#9d9d9d}.action-container[data-v-4b25e1c0]{width:100%;height:100%;position:fixed;top:0;left:0;display:flex;justify-content:center;align-items:center}.action-container .layer[data-v-4b25e1c0]{position:absolute;top:0;left:0;background:rgba(51,51,51,.5);width:100%;height:100%;z-index:99}.action-container .action-box[data-v-4b25e1c0]{width:%?400?%;height:%?240?%;background:#fff;position:relative;z-index:100;border-radius:%?20?%;overflow:hidden}.action-container .action-item[data-v-4b25e1c0]{text-align:center;line-height:%?120?%;font-size:%?34?%;color:#262628;border-bottom:1px solid #efefef}.item-head[data-v-4b25e1c0]{position:relative}.item-head .item-head_unread[data-v-4b25e1c0]{padding:%?6?%;background-color:#ee593c;color:#fff;font-size:%?34?%;line-height:%?28?%;border-radius:%?24?%;min-width:%?24?%;min-height:%?24?%;text-align:center;position:absolute;top:0;right:%?15?%}",""]),t.exports=e},"2ec5":function(t,e,n){"use strict";t.exports=function(t,e){return e||(e={}),t=t&&t.__esModule?t.default:t,"string"!==typeof t?t:(/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t)}},4447:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAABgSURBVHgB7Y6xDYAwDASDvQAjsBmNF2CDsAEDuGEzRsgCtnikBCEqQpucFOlPl8IhdBpmUNXZzDbsxMxRRPYSaxpBImTEm3K4qWmUpZBeF39u5O4LxnEJ9vr8+bd1muMEOUNL5++YjiMAAAAASUVORK5CYII="},"57e0":function(t,e,n){"use strict";n.r(e);var i=n("7a3b"),o=n("ef5b");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("7b90");var s=n("828b"),c=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,"4b25e1c0",null,!1,i["a"],void 0);e["default"]=c.exports},"7a3b":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-scroll-view",{staticClass:"conversations",attrs:{"scroll-y":"true"}},[t.conversations.length?n("v-uni-view",t._l(t.conversations,(function(e,i){return n("v-uni-view",{key:i,staticClass:"scroll-item"},[n("v-uni-view",{staticClass:"item-head"},[n("v-uni-image",{staticClass:"head-icon",attrs:{src:e.data.avatar}}),e.unread?n("v-uni-view",{staticClass:"item-head_unread"},[t._v(t._s(e.unread))]):t._e()],1),n("v-uni-view",{staticClass:"scroll-item_info",on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.chat(e)}}},[n("v-uni-view",{staticClass:"item-info-top"},[n("v-uni-text",{staticClass:"item-info-top_name"},[t._v(t._s(e.data.name))]),n("v-uni-view",{staticClass:"item-info-top_time"},[t._v(t._s(t.formatDate(e.lastMessage.timestamp)))])],1),n("v-uni-view",{staticClass:"item-info-bottom"},[n("v-uni-view",{staticClass:"item-info-bottom-item"},[n("v-uni-view",{staticClass:"item-info-top_content"},["CS_TRANSFER"===e.lastMessage.type?n("v-uni-text",[t._v(t._s(e.lastMessage.payload.transferTo.data.name)+"已接入")]):n("v-uni-view",[n("v-uni-text",[t._v(t._s(e.lastMessage.senderId===t.currentCustomer.id?"我":e.lastMessage.senderData.name)+":")]),"text"===e.lastMessage.type?n("v-uni-text",[t._v(t._s(e.lastMessage.payload.text))]):"video"===e.lastMessage.type?n("v-uni-text",[t._v("[视频消息]")]):"audio"===e.lastMessage.type?n("v-uni-text",[t._v("[语音消息]")]):"image"===e.lastMessage.type?n("v-uni-text",[t._v("[图片消息]")]):"order"===e.lastMessage.type?n("v-uni-text",[t._v("[自定义消息:订单]")]):"CS_END"===e.lastMessage.type?n("v-uni-text",[t._v("会话已结束")]):"CS_ACCEPT"===e.lastMessage.type?n("v-uni-text",[t._v("已接入")]):n("v-uni-text",[t._v("[[未识别内容]]")])],1)],1),n("v-uni-view",{staticClass:"item-info-bottom_action",on:{click:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.showAction(e)}}})],1)],1)],1)],1)})),1):n("v-uni-view",{staticClass:"no-conversation"},[t._v("当前没有会话")]),t.actionPopup.visible?n("v-uni-view",{staticClass:"action-container"},[n("v-uni-view",{staticClass:"layer",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.actionPopup.visible=!1}}}),n("v-uni-view",{staticClass:"action-box"},[n("v-uni-view",{staticClass:"action-item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.topConversation.apply(void 0,arguments)}}},[t._v(t._s(t.actionPopup.conversation.top?"取消置顶":"置顶聊天"))]),n("v-uni-view",{staticClass:"action-item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.deleteConversation.apply(void 0,arguments)}}},[t._v("删除聊天")])],1)],1):t._e()],1)},o=[]},"7b90":function(t,e,n){"use strict";var i=n("db28"),o=n.n(i);o.a},c04d:function(t,e,n){"use strict";n("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("c9b5"),n("bf0f"),n("ab80"),n("d4b5");var i=n("0d65"),o={name:"conversation",data:function(){return{conversations:[],actionPopup:{conversation:null,visible:!1},currentCustomer:null}},onShow:function(){this.currentCustomer=getApp().globalData.currentCustomer,this.loadConversations(),this.goEasy.im.on(this.GoEasy.IM_EVENT.CONVERSATIONS_UPDATED,this.renderConversations)},beforeDestroy:function(){this.goEasy.im.off(this.GoEasy.IM_EVENT.CONVERSATIONS_UPDATED,this.renderConversations)},methods:{formatDate:i.formatDate,loadConversations:function(){var t=this;this.goEasy.im.latestConversations({onSuccess:function(e){var n=e.content;n.unreadTotal>0?uni.setTabBarBadge({index:1,text:n.unreadTotal.toString()}):uni.removeTabBarBadge({index:1}),t.renderConversations(n)},onFailed:function(t){console.log("获取最新会话列表失败, error:",t)}})},renderConversations:function(t){this.conversations=t.conversations},showAction:function(t){this.actionPopup.conversation=t,this.actionPopup.visible=!0},topConversation:function(){this.actionPopup.visible=!1;var t=this.actionPopup.conversation,e=t.top?"取消置顶":"置顶";this.goEasy.im.topConversation({top:!t.top,conversation:t,onSuccess:function(){uni.showToast({title:e+"成功",icon:"none"})},onFailed:function(t){console.log(e,"失败：",t)}})},deleteConversation:function(){var t=this;uni.showModal({content:"确认删除这条会话吗？",success:function(e){if(e.confirm){t.actionPopup.visible=!1;var n=t.actionPopup.conversation;t.goEasy.im.removeConversation({conversation:n,onSuccess:function(){uni.showToast({title:"删除成功",icon:"none"})},onFailed:function(t){console.log("删除失败，error:",t)}})}else t.actionPopup.visible=!1}})},chat:function(t){var e={id:t.id,name:t.data.name,avatar:t.data.avatar};uni.navigateTo({url:"./chat?to="+JSON.stringify(e)})}}};e.default=o},db28:function(t,e,n){var i=n("1f7e");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=n("967d").default;o("71e12cd0",i,!0,{sourceMap:!1,shadowMode:!1})},ef5b:function(t,e,n){"use strict";n.r(e);var i=n("c04d"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a}}]);