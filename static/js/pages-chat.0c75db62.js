(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-chat"],{"0d65":function(e,t,i){"use strict";i("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.formatDate=function(e){e=e||Date.now();var t=new Date(e),i=t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1;return i+="-",i+=t.getDate()<10?"0"+t.getDate():t.getDate(),i+=" ",i+=t.getHours(),i+=":",i+=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),i},t.formateTime=function(e){var t=(new Date).getTime(),i=t-e,a=i/1e3,o=i/6e4,s=i/36e5,n=i/864e5;return n>=1?parseInt(n)+"天":s>=1?parseInt(s)+"小时":o>=1?parseInt(o)+"分钟":a>=1?parseInt(a)+"秒":"0秒"},i("e966")},"2ec5":function(e,t,i){"use strict";e.exports=function(e,t){return t||(t={}),e=e&&e.__esModule?e.default:e,"string"!==typeof e?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},3651:function(e,t,i){var a=i("c86c"),o=i("2ec5"),s=i("e0c8"),n=i("672e"),r=i("7a7d"),d=i("f8b0");t=a(!1);var c=o(s),l=o(n),u=o(r),g=o(d);t.push([e.i,"uni-page-body[data-v-1f830309]{height:100%}.chatInterface[data-v-1f830309]{height:100%;background-color:#f1f1f1;display:flex;flex-direction:column}.scroll-view[data-v-1f830309]{padding-left:%?20?%;padding-right:%?20?%;box-sizing:border-box;-webkit-overflow-scrolling:touch;padding-bottom:%?120?%;background-color:#f1f1f1;flex:1}.history-loading[data-v-1f830309]{width:100%;text-align:center}.history-loading uni-image[data-v-1f830309]{width:%?20?%;height:%?20?%}.scroll-view .history-loaded[data-v-1f830309]{font-size:%?34?%;height:%?60?%;line-height:%?60?%;width:100%;text-align:center;color:#ccc}.scroll-view .load[data-v-1f830309]{font-size:%?34?%;height:%?60?%;line-height:%?60?%;margin:%?15?% 0;width:100%;text-align:center;color:#d02129}.scroll-view .message-item[data-v-1f830309]{display:flex;margin:%?20?% 0}.scroll-view .message-item .message-item-content[data-v-1f830309]{flex:1;overflow:hidden;display:flex}.scroll-view .message-item .message-item-content.self[data-v-1f830309]{overflow:hidden;display:flex;justify-content:flex-start;flex-direction:row-reverse}.scroll-view .message-item .avatar[data-v-1f830309]{width:%?80?%;height:%?80?%;flex-shrink:0;flex-grow:0}.scroll-view .message-item .avatar uni-image[data-v-1f830309]{width:100%;height:100%;border-radius:50%}.scroll-view .message-item .accept-message[data-v-1f830309]{width:100%;text-align:center;color:#333;font-size:%?34?%}.scroll-view .content[data-v-1f830309]{font-size:%?34?%;line-height:%?44?%;margin:0 %?20?%;max-width:%?520?%;display:flex;flex-direction:column}.scroll-view .content .staff-name[data-v-1f830309]{font-size:%?34?%;color:#888}.scroll-view .content .message-payload[data-v-1f830309]{display:flex;align-items:center}.scroll-view .content .image-content[data-v-1f830309]{border-radius:%?12?%}.scroll-view .content .text-content img[data-v-1f830309]{width:%?50?%;height:%?50?%}.scroll-view .content .order-content[data-v-1f830309]{border-radius:%?20?%;background:#fff;padding:%?16?%;display:flex;flex-direction:column}.audio-content[data-v-1f830309]{height:%?86?%;-webkit-tap-highlight-color:rgba(0,0,0,0)}.audio-content .audio-facade[data-v-1f830309]{min-width:%?20?%;padding:%?6?% %?10?%;line-height:%?72?%;background:#fff;font-size:%?34?%;border-radius:%?14?%;color:#000;display:flex;flex-direction:row-reverse}.audio-content .audio-facade-bg[data-v-1f830309]{background:url(/static/images/voice.png) no-repeat 50%;background-size:%?30?%;width:%?40?%;-webkit-transform:rotate(180deg);transform:rotate(180deg)}.audio-content .audio-facade-bg.play-icon[data-v-1f830309]{background:url(/static/images/play.gif) no-repeat 50%;background-size:%?30?%}.scroll-view .content .order-id[data-v-1f830309]{color:#333}.scroll-view .content .order-body[data-v-1f830309]{padding:%?10?%}.scroll-view .content .order-name[data-v-1f830309]{font-weight:400}.scroll-view .content .order-info[data-v-1f830309]{display:flex;justify-content:space-between;padding:%?10?%}.scroll-view .content .order-info .order-price[data-v-1f830309]{font-weight:400}.scroll-view .content .pending[data-v-1f830309]{background:url("+c+") no-repeat 50%;background-size:%?30?%;width:%?30?%;height:%?30?%;margin-right:%?10?%}.scroll-view .content .send-fail[data-v-1f830309]{background:url("+l+") no-repeat 50%;background-size:%?30?%;width:%?30?%;height:%?30?%;margin-right:%?10?%}.action-box[data-v-1f830309]{display:flex;-webkit-backdrop-filter:blur(%?0.27?%);backdrop-filter:blur(%?0.27?%);width:100%;position:fixed;bottom:0;left:0;flex-direction:column;background-color:#f1f1f1}.action-box .action-top[data-v-1f830309]{display:flex;align-items:center;box-sizing:border-box;background:#f6f6f6;-webkit-backdrop-filter:blur(27.1828px);backdrop-filter:blur(27.1828px);border-top:1px solid #ececec;padding:0 %?20?%}.consult-input[data-v-1f830309]{flex:1;height:%?80?%;padding-left:%?20?%;margin:%?20?%;margin-left:0;border:none;outline:none;box-sizing:border-box;border-radius:6px;background:#fff;font-size:%?34?%}.more[data-v-1f830309]{width:%?62?%;height:%?62?%;margin-right:%?10?%;display:flex}.send-btn-box[data-v-1f830309]{display:flex;align-items:center;justify-content:center;width:%?110?%;height:%?60?%;border-radius:%?10?%;background:#d02129}.send-btn-box .btn[data-v-1f830309]{color:#fff;font-size:%?34?%}.action-box .action-bottom .more-icon[data-v-1f830309]{display:flex;align-items:center;flex-direction:column;padding:0 %?30?%}.action-box .action-bottom .operation-icon[data-v-1f830309]{width:%?60?%;height:%?60?%;min-width:%?60?%;min-height:%?60?%;padding:%?25?%;border-radius:%?20?%;background:#fff}.action-box .action-bottom .operation-title[data-v-1f830309]{font-size:%?34?%;line-height:%?50?%;color:#82868e}.action-box .action-top .record-input[data-v-1f830309]{flex:1;width:%?480?%;height:%?80?%;line-height:%?80?%;padding-left:%?20?%;margin:%?20?%;margin-left:0;border:none;outline:none;box-sizing:border-box;border-radius:6px;background:#ccc;color:#fff;font-size:%?34?%;text-align:center}.action-bottom[data-v-1f830309]{height:%?300?%;width:100%;padding:%?20?%;box-sizing:border-box;display:flex}.action-bottom-emoji[data-v-1f830309]{justify-content:space-around}.action-bottom uni-image[data-v-1f830309]{width:%?100?%;height:%?100?%}.record-loading[data-v-1f830309]{position:fixed;top:50%;left:50%;width:%?300?%;height:%?300?%;margin:%?-150?% %?-150?%;background:#262628;background:url("+u+") no-repeat 50%;background-size:100%;border-radius:%?40?%}.video-player[data-v-1f830309]{display:block;position:fixed;left:0;top:0;width:100%;height:100%;z-index:999;background:rgba(0,0,0,.8)}.video-player uni-video[data-v-1f830309]{width:100%;height:100%}.img-layer uni-image[data-v-1f830309]{height:100%!important}.order-list[data-v-1f830309]{position:fixed;top:0;bottom:0;z-index:10;width:100vw;height:100vh;background:rgba(0,0,0,.5)}.orders-content[data-v-1f830309]{position:absolute;width:100%;bottom:0;background:#f1f1f1;z-index:200}.title[data-v-1f830309]{font-weight:600;font-size:%?34?%;color:#000;margin-left:%?20?%;margin-right:%?20?%;display:flex;justify-content:space-between;align-items:center}.close[data-v-1f830309]{font-size:%?50?%}.order-item[data-v-1f830309]{padding:%?20?%;background:#fff;margin:%?20?%;border-radius:%?20?%}.order-id[data-v-1f830309]{font-size:%?34?%;color:#666;margin-bottom:%?10?%}.order-body[data-v-1f830309]{display:flex;font-size:%?34?%}.order-img[data-v-1f830309]{width:%?120?%;height:%?120?%;border-radius:%?10?%}.order-name[data-v-1f830309]{margin-left:%?20?%;width:%?270?%}.order-right[data-v-1f830309]{flex:1;display:flex;flex-direction:column;align-items:center}.order-price[data-v-1f830309]{font-weight:700}.order-count[data-v-1f830309]{font-size:%?34?%;color:#666}.video-snapshot[data-v-1f830309]{position:relative}.video-snapshot uni-video[data-v-1f830309]{max-height:%?300?%;max-width:%?400?%}.video-snapshot .video-play-icon[data-v-1f830309]{position:absolute;width:%?40?%;height:%?40?%;border-radius:%?20?%;background:url("+g+") no-repeat 50%;background-size:100%;top:50%;left:50%;margin:%?-20?%}.time-lag[data-v-1f830309]{font-size:%?34?%;text-align:center}",""]),e.exports=t},"4fcc":function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){}));var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"chatInterface"},[i("v-uni-view",{staticClass:"scroll-view"},[e.history.loading?i("v-uni-image",{staticClass:"history-loaded",attrs:{src:"/static/images/loading.svg"}}):i("v-uni-view",{class:e.history.allLoaded?"history-loaded":"load",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.loadHistoryMessage(!1)}}},[i("v-uni-view",[e._v(e._s(e.history.allLoaded?"已经没有更多的历史消息":"点击获取历史消息"))])],1),i("v-uni-view",{staticClass:"message-list"},e._l(e.history.messages,(function(t,a){return i("v-uni-view",{key:t.messageId},[i("v-uni-view",{staticClass:"time-lag"},[e._v(e._s(e.renderMessageDate(t,a)))]),i("v-uni-view",{staticClass:"message-item"},["CS_ACCEPT"===t.type?i("v-uni-view",{staticClass:"accept-message"},[e._v(e._s(t.senderData.name)+"已接入")]):"CS_END"===t.type?i("v-uni-view",{staticClass:"accept-message"},[e._v(e._s(t.senderData.name)+"已结束会话")]):"CS_TRANSFER"===t.type?i("div",{staticClass:"accept-message"},[e._v(e._s(t.payload.transferTo.data.name)+"已接入")]):i("v-uni-view",{staticClass:"message-item-content",class:{self:t.senderId===e.currentCustomer.id}},[i("v-uni-view",{staticClass:"avatar"},[i("v-uni-image",{attrs:{src:t.senderId===e.currentCustomer.id?e.currentCustomer.avatar:e.shop.avatar}})],1),i("v-uni-view",{staticClass:"content"},[t.senderId!==e.currentCustomer.id?i("v-uni-view",{staticClass:"staff-name"},[e._v(e._s(t.senderData.name))]):e._e(),i("v-uni-view",{staticClass:"message-payload"},["sending"===t.status?i("b",{staticClass:"pending"}):e._e(),"fail"===t.status?i("b",{staticClass:"send-fail"}):e._e(),"text"===t.type?i("v-uni-view",{domProps:{innerHTML:e._s(e.renderTextMessage(t))}}):e._e(),"image"===t.type?i("v-uni-image",{staticClass:"image-content",style:{height:e.getImageHeight(t.payload.width,t.payload.height)+"rpx"},attrs:{"data-url":t.payload.url,src:t.payload.url,mode:"heightFix"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.showImageFullScreen.apply(void 0,arguments)}}}):e._e(),"video"===t.type?i("v-uni-view",{staticClass:"video-snapshot",attrs:{"data-url":t.payload.video.url},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.playVideo.apply(void 0,arguments)}}},[i("v-uni-image",{style:{height:e.getImageHeight(t.payload.thumbnail.width,t.payload.thumbnail.height)+"rpx"},attrs:{src:t.payload.thumbnail.url,mode:"heightFix"}}),i("v-uni-view",{staticClass:"video-play-icon"})],1):e._e(),"audio"===t.type?i("v-uni-view",{staticClass:"audio-content",on:{click:function(i){arguments[0]=i=e.$handleEvent(i),e.playAudio(t)}}},[i("v-uni-view",{staticClass:"audio-facade",style:{width:7*Math.ceil(t.payload.duration)+50+"px"}},[i("v-uni-view",{staticClass:"audio-facade-bg",class:{"play-icon":e.audioPlayer.playingMessage&&e.audioPlayer.playingMessage.messageId===t.messageId}}),i("v-uni-view",[e._v(e._s(Math.ceil(t.payload.duration)||1)),i("span",[e._v('"')])])],1)],1):e._e(),"order"===t.type?i("v-uni-view",{staticClass:"order-content"},[i("v-uni-view",{staticClass:"order-id"},[e._v("订单号："+e._s(t.payload.id))]),i("v-uni-view",{staticClass:"order-body"},[i("v-uni-image",{staticClass:"order-img",attrs:{src:t.payload.url}}),i("v-uni-view",[i("v-uni-view",{staticClass:"order-name"},[e._v(e._s(t.payload.name))]),i("v-uni-view",{staticClass:"order-info"},[i("v-uni-view",{staticClass:"order-price"},[e._v(e._s(t.payload.price))]),i("v-uni-view",{staticClass:"order-count"},[e._v("共"+e._s(t.payload.count)+"件")])],1)],1)],1)],1):e._e()],1)],1)],1)],1)],1)})),1)],1),i("v-uni-view",{staticClass:"action-box"},[i("v-uni-view",{staticClass:"action-top"},[i("v-uni-view",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.switchAudioKeyboard.apply(void 0,arguments)}}},[e.audio.visible?i("v-uni-image",{staticClass:"more",attrs:{src:"/static/images/jianpan.png"}}):i("v-uni-image",{staticClass:"more",attrs:{src:"/static/images/audio.png"}})],1),e.audio.visible?i("v-uni-view",{staticClass:"record-input",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.onRecordStart.apply(void 0,arguments)},touchend:function(t){arguments[0]=t=e.$handleEvent(t),e.onRecordEnd.apply(void 0,arguments)},touchstart:function(t){arguments[0]=t=e.$handleEvent(t),e.onRecordStart.apply(void 0,arguments)}}},[e._v(e._s(e.audio.recording?"松开发送":"按住录音"))]):i("v-uni-input",{staticClass:"consult-input",attrs:{maxlength:"700",placeholder:"发送消息",type:"text"},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.sendTextMessage.apply(void 0,arguments)}},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),i("v-uni-view",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.switchEmojiKeyboard.apply(void 0,arguments)}}},[e.emoji.visible?i("v-uni-image",{staticClass:"more",attrs:{src:"/static/images/jianpan.png"}}):i("v-uni-image",{staticClass:"more",attrs:{src:"/static/images/emoji.png"}})],1),i("v-uni-view",[i("v-uni-image",{staticClass:"more",attrs:{src:"/static/images/more.png"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.showOtherTypesMessagePanel()}}})],1),e.text?i("v-uni-view",{staticClass:"send-btn-box"},[i("v-uni-text",{staticClass:"btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.sendTextMessage()}}},[e._v("发送")])],1):e._e()],1),e.emoji.visible?i("v-uni-view",{staticClass:"action-bottom action-bottom-emoji"},e._l(e.emoji.map,(function(t,a,o){return i("v-uni-image",{key:o,staticClass:"emoji-item",attrs:{src:e.emoji.url+t},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.chooseEmoji(a)}}})})),1):e._e(),e.otherTypesMessagePanelVisible?i("v-uni-view",{staticClass:"action-bottom"},[i("v-uni-view",{staticClass:"more-icon"},[i("v-uni-image",{staticClass:"operation-icon",attrs:{src:"/static/images/picture.png"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.sendImageMessage()}}}),i("v-uni-view",{staticClass:"operation-title"},[e._v("图片")])],1),i("v-uni-view",{staticClass:"more-icon"},[i("v-uni-image",{staticClass:"operation-icon",attrs:{src:"/static/images/video.png"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.sendVideoMessage()}}}),i("v-uni-view",{staticClass:"operation-title"},[e._v("视频")])],1),i("v-uni-view",{staticClass:"more-icon"},[i("v-uni-image",{staticClass:"operation-icon",attrs:{src:"/static/images/order.png"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.showOrderMessageList()}}}),i("v-uni-view",{staticClass:"operation-title"},[e._v("订单")])],1)],1):e._e()],1),e.audio.recording?i("v-uni-view",{staticClass:"record-loading"}):e._e(),e.videoPlayer.visible?i("v-uni-video",{attrs:{id:"videoPlayer",src:e.videoPlayer.url},on:{fullscreenchange:function(t){arguments[0]=t=e.$handleEvent(t),e.onVideoFullScreenChange.apply(void 0,arguments)}}}):e._e(),e.orderList.visible?i("v-uni-view",{staticClass:"order-list"},[i("v-uni-view",{staticClass:"orders-content"},[i("v-uni-view",{staticClass:"title"},[i("v-uni-view",[e._v("请选择一个订单")]),i("v-uni-view",{staticClass:"close",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.hideOrderMessageList.apply(void 0,arguments)}}},[e._v("×")])],1),i("v-uni-view",{staticClass:"orders"},e._l(e.orderList.orders,(function(t,a){return i("v-uni-view",{key:a,staticClass:"order-item",on:{click:function(i){arguments[0]=i=e.$handleEvent(i),e.sendOrderMessage(t)}}},[i("v-uni-view",{staticClass:"order-id"},[e._v("订单号："+e._s(t.id))]),i("v-uni-view",{staticClass:"order-body"},[i("v-uni-image",{staticClass:"order-img",attrs:{src:t.url}}),i("v-uni-view",{staticClass:"order-name"},[e._v(e._s(t.name))]),i("v-uni-view",{staticClass:"order-right"},[i("v-uni-view",{staticClass:"order-price"},[e._v(e._s(t.price))]),i("v-uni-view",{staticClass:"order-count"},[e._v("共"+e._s(t.count)+"件")])],1)],1)],1)})),1)],1)],1):e._e()],1)},o=[]},6307:function(e,t,i){"use strict";i.r(t);var a=i("4fcc"),o=i("73fc");for(var s in o)["default"].indexOf(s)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(s);i("ce08");var n=i("828b"),r=Object(n["a"])(o["default"],a["b"],a["c"],!1,null,"1f830309",null,!1,a["a"],void 0);t["default"]=r.exports},6561:function(e,t,i){"use strict";i("6a54");var a=i("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("aa9c"),i("0c26"),i("c223"),i("bf0f"),i("2797");var o=a(i("d874")),s=i("0d65"),n=a(i("94d1")),r=uni.getRecorderManager(),d={data:function(){var e="https://imgcache.qq.com/open/qcloud/tim/assets/emoji/",t={"[么么哒]":"emoji_3@2x.png","[乒乓]":"emoji_4@2x.png","[便便]":"emoji_5@2x.png","[信封]":"emoji_6@2x.png","[偷笑]":"emoji_7@2x.png","[傲慢]":"emoji_8@2x.png"};return{currentCustomer:{},shop:{},to:{},text:"",emoji:{url:e,map:t,visible:!1,decoder:new n.default(e,t)},otherTypesMessagePanelVisible:!1,orderList:{orders:[],visible:!1},history:{messages:[],allLoaded:!1,loading:!0},audio:{startTime:null,recording:!1,visible:!1},audioPlayer:{innerAudioContext:null,playingMessage:null},videoPlayer:{visible:!1,url:"",context:null}}},onLoad:function(e){this.shop=JSON.parse(e.to),this.to={id:this.shop.id,type:this.GoEasy.IM_SCENE.CS,data:{name:this.shop.name,avatar:this.shop.avatar}},this.currentCustomer=getApp().globalData.currentCustomer,this.markMessageAsRead(),this.loadHistoryMessage(!0),this.initialAudioPlayer(),this.initRecorderListeners(),this.goEasy.im.on(this.GoEasy.IM_EVENT.CS_MESSAGE_RECEIVED,this.onMessageReceived)},onReady:function(){this.videoPlayer.context=uni.createVideoContext("videoPlayer",this),uni.setNavigationBarTitle({title:this.shop.name})},onShow:function(){this.otherTypesMessagePanelVisible=!1,this.emoji.visible=!1},beforeDestroy:function(){this.goEasy.im.off(this.GoEasy.IM_EVENT.CS_MESSAGE_RECEIVED,this.onMessageReceived)},methods:{getImageHeight:function(e,t){return e<200&&t<150?2*t:e>t?200/e*t*2:e===t||e<t?300:void 0},renderMessageDate:function(e,t){return 0===t||e.timestamp-this.history.messages[t-1].timestamp>3e5?(0,s.formatDate)(e.timestamp):""},initialAudioPlayer:function(){var e=this;this.audioPlayer.innerAudioContext=uni.createInnerAudioContext(),this.audioPlayer.innerAudioContext.onEnded((function(){e.audioPlayer.playingMessage=null})),this.audioPlayer.innerAudioContext.onStop((function(){e.audioPlayer.playingMessage=null}))},initRecorderListeners:function(){var e=this;r.onStart((function(){e.audio.recording=!0,e.audio.startTime=Date.now()})),r.onStop((function(t){var i=Date.now();e.audio.recording=!1;var a=i-e.audio.startTime;a<1e3?uni.showToast({icon:"error",title:"录音时间太短",duration:500}):(t.duration=a,e.sendAudioMessage(t))})),r.onError((function(t){e.audio.recording=!1,r.stop(),uni.showToast({icon:"none",title:"录音失败,请检查麦克风权限",duration:1e3})}))},renderTextMessage:function(e){return'<span class="text-content">'+this.emoji.decoder.decode(e.payload.text)+"</span>"},onMessageReceived:function(e){e.teamId===this.shop.id&&(this.history.messages.push(e),this.markMessageAsRead(),this.scrollToBottom())},switchEmojiKeyboard:function(){this.emoji.visible=!this.emoji.visible,this.otherTypesMessagePanelVisible=!1},showOtherTypesMessagePanel:function(){this.otherTypesMessagePanelVisible=!this.otherTypesMessagePanelVisible,this.emoji.visible=!1},chooseEmoji:function(e){this.text+=e},sendAudioMessage:function(e){var t=this;this.goEasy.im.createAudioMessage({to:this.to,file:e,notification:{title:this.currentCustomer.name+"发来一段语音",body:"[语音消息]"},onProgress:function(e){console.log(e)},onSuccess:function(e){t.sendMessage(e)},onFailed:function(e){console.log("error :",e)}})},sendTextMessage:function(){var e=this;if(""!==this.text.trim()){var t=this.text;this.text.length>=50&&(t=this.text.substring(0,30)+"..."),this.goEasy.im.createTextMessage({text:this.text,to:this.to,notification:{title:this.currentCustomer.name+"发来一段文字",body:t},onSuccess:function(t){e.sendMessage(t)},onFailed:function(e){console.log("error :",e)}})}this.text=""},sendMessage:function(e){this.history.messages.push(e),this.scrollToBottom(),this.goEasy.im.sendMessage({message:e,onSuccess:function(e){console.log("发送成功.",e)},onFailed:function(e){507===e.code?(uni.showModal({title:"发送语音/图片/视频/文件失败",content:"没有配置OSS存储, 详情参考GoEasy官方文档"}),console.log("发送语音/图片/视频/文件失败，没有配置OSS存储，详情参考：https://docs.goeasy.io/2.x/im/message/media/alioss")):console.log("发送失败:",e)}})},scrollToBottom:function(){this.$nextTick((function(){uni.pageScrollTo({scrollTop:2e6,duration:0})}))},loadHistoryMessage:function(e){var t=this;this.history.loading=!0;var i=null,a=this.history.messages[0];a&&(i=a.timestamp),this.goEasy.im.history({type:this.GoEasy.IM_SCENE.CS,id:this.shop.id,lastTimestamp:i,limit:10,onSuccess:function(a){t.history.loading=!1;var o=a.content;0===o.length?t.history.allLoaded=!0:(t.history.messages=i?o.concat(t.history.messages):o,o.length<10&&(t.history.allLoaded=!0),e&&t.scrollToBottom())},onFailed:function(e){console.log("获取历史消息失败:",e),t.history.loading=!1}})},switchAudioKeyboard:function(){this.audio.visible=!this.audio.visible},onRecordStart:function(){try{r.start()}catch(e){uni.showModal({title:"录音错误",content:"请在app和小程序端体验录音，Uni官方明确H5不支持getRecorderManager, 详情查看Uni官方文档"})}},onRecordEnd:function(){try{r.stop()}catch(e){console.log(e)}},sendVideoMessage:function(){var e=this;uni.chooseVideo({success:function(t){e.goEasy.im.createVideoMessage({to:e.to,file:t,notification:{title:e.currentCustomer.name+"发来一个视频",body:"[视频消息]"},onProgress:function(e){console.log(e)},onSuccess:function(t){e.otherTypesMessagePanelVisible=!1,e.sendMessage(t)},onFailed:function(e){console.log("error :",e)}})}})},sendImageMessage:function(){var e=this;uni.chooseImage({count:9,success:function(t){t.tempFiles.forEach((function(t){e.goEasy.im.createImageMessage({to:e.to,file:t,notification:{title:e.currentCustomer.name+"发来一张图片",body:"[图片消息]"},onProgress:function(e){console.log(e)},onSuccess:function(t){e.otherTypesMessagePanelVisible=!1,e.sendMessage(t)},onFailed:function(e){console.log("error :",e)}})}))}})},showOrderMessageList:function(){this.orderList.orders=o.default.getOrderList(),this.orderList.visible=!0},hideOrderMessageList:function(){this.orderList.visible=!1},sendOrderMessage:function(e){var t=this;this.goEasy.im.createCustomMessage({type:"order",payload:e,to:this.to,notification:{title:this.currentCustomer.name+"发来一个订单",body:"[订单消息]"},onSuccess:function(e){t.otherTypesMessagePanelVisible=!1,t.sendMessage(e)},onFailed:function(e){console.log("error :",e)}}),this.orderList.visible=!1},showImageFullScreen:function(e){var t=[e.currentTarget.dataset.url];uni.previewImage({urls:t})},playVideo:function(e){var t=this;this.videoPlayer.visible=!0,this.videoPlayer.url=e.currentTarget.dataset.url,this.$nextTick((function(){t.videoPlayer.context.requestFullScreen({direction:0}),t.videoPlayer.context.play()}))},playAudio:function(e){var t=this.audioPlayer.playingMessage;t&&(this.audioPlayer.innerAudioContext.stop(),t===e)||(this.audioPlayer.playingMessage=e,this.audioPlayer.innerAudioContext.src=e.payload.url,this.audioPlayer.innerAudioContext.play())},onVideoFullScreenChange:function(e){this.videoPlayer.visible&&!e.detail.fullScreen&&(this.videoPlayer.visible=!1,this.videoPlayer.context.stop())},markMessageAsRead:function(){this.goEasy.im.markMessageAsRead({type:this.GoEasy.IM_SCENE.CS,id:this.shop.id,onSuccess:function(){console.log("标记已读成功")},onFailed:function(e){console.log("标记已读失败",e)}})}}};t.default=d},"672e":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAP1BMVEUAAADsWDrvWTrvWTruWjvuWTvsVz3rVEDuWTvuWTvuWDruWjvvWTvvWjruWTv////ygmzwblPvY0f0l4TxeGB8BezSAAAADnRSTlMAYN+v75BQEIDPsM/Pf6ieeMkAAACGSURBVBjTbZDbEoMgDESTgKC9bET7/9/aajBUcV/YnNmZkKVdmYMAr8DUlCKqxPGAP72NjTYtxd5hY2y+qC7m0g+K2Vl1NhczMa4QTKGHD5p6KIQe4h5KNZ8Gn74I6wpfxIBf5F/K8XqRbBXVoGo5gq2kUoPjqSYvycRyoJioicMESOC8T1/VVRDZtVqLEwAAAABJRU5ErkJggg=="},"73fc":function(e,t,i){"use strict";i.r(t);var a=i("6561"),o=i.n(a);for(var s in a)["default"].indexOf(s)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(s);t["default"]=o.a},"7a7d":function(e,t,i){e.exports=i.p+"static/images/recording-loading.gif"},"94d1":function(e,t,i){"use strict";i("6a54");var a=i("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("aa9c"),i("5c47"),i("a1c1"),i("23f4"),i("7d2f"),i("9c4e"),i("ab80");var o=a(i("80b1")),s=a(i("efe5")),n=a(i("39d8")),r=function(){function e(t,i){for(var a in(0,o.default)(this,e),(0,n.default)(this,"emojiMap",null),(0,n.default)(this,"url",""),(0,n.default)(this,"patterns",[]),(0,n.default)(this,"metaChars",/[[\]{}()*+?.\\|^$\-,&#\s]/g),this.url=t||"",this.emojiMap=i||{},this.emojiMap)this.emojiMap.hasOwnProperty(a)&&this.patterns.push("("+a.replace(this.metaChars,"\\$&")+")")}return(0,s.default)(e,[{key:"decode",value:function(e){var t=this;return e.replace(new RegExp(this.patterns.join("|"),"g"),(function(e){return"undefined"!=typeof t.emojiMap[e]?'<img height="25px" width="25px" src="'+t.url+t.emojiMap[e]+'" />':e}))}}]),e}(),d=r;t.default=d},b602:function(e,t,i){var a=i("3651");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=i("967d").default;o("fcfee154",a,!0,{sourceMap:!1,shadowMode:!1})},ce08:function(e,t,i){"use strict";var a=i("b602"),o=i.n(a);o.a},d874:function(e,t,i){"use strict";i("6a54");var a=i("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("aa77"),i("bf0f"),i("2797");var o=a(i("80b1")),s=a(i("efe5")),n=a(i("39d8")),r=function(){function e(){(0,o.default)(this,e),(0,n.default)(this,"customers",[{id:"3f99d89d-99c0-44f7-96c9-e4c6ff5ac4d2",name:"Mattie",password:"123",avatar:"/static/images/Avatar-1.png",email:"Mattie@goeasy.io",phone:"138xxxxxxxx"},{id:"413985eb-c120-41ab-baea-93c3e751a14a",name:"Wallace",password:"123",avatar:"/static/images/Avatar-2.png",email:"Wallace@goeasy.io",phone:"138xxxxxxxx"},{id:"ce525fb0-99db-4e1a-bdac-1d09911cae7f",name:"Tracy",password:"123",avatar:"/static/images/Avatar-3.png",email:"Tracy@goeasy.io",phone:"138xxxxxxxx"},{id:"68663b2b-d824-46e9-983a-24cc2ab22df6",name:"Juanita",password:"123",avatar:"/static/images/Avatar-4.png",email:"Juanita@goeasy.io",phone:"138xxxxxxxx"}]),(0,n.default)(this,"shops",[{name:"GoEasy食品自营",avatar:"/static/images/shop1.png",id:"shop01",goods:["/static/images/goods1-1.jpg","/static/images/goods1-2.jpg","/static/images/goods1-3.jpg"]},{name:"GoEasy家具生活自营",avatar:"/static/images/shop2.png",id:"shop02",goods:["/static/images/goods2-1.jpg","/static/images/goods2-2.jpg","/static/images/goods2-3.jpg"]},{name:"GoEasy电器自营",avatar:"/static/images/shop3.png",id:"shop03",goods:["/static/images/goods3-1.jpg","/static/images/goods3-2.jpg","/static/images/goods3-3.jpg"]}]),(0,n.default)(this,"agents",[{id:"6ec2c1df-24f4-4c33-a16c-d0c9de69ac09",name:"Kim",password:"123",avatar:"/static/images/Avatar-5.png",email:"Kim@goeasy.io",phone:"138xxxxxxxx",shopId:"shop01"},{id:"93f76849-6db8-47f1-a68f-6e597b45179a",name:"Molly",password:"123",avatar:"/static/images/Avatar-6.png",email:"Molly@goeasy.io",phone:"138xxxxxxxx",shopId:"shop01"},{id:"9c4ebaa6-e447-49cc-8091-34fdc25a3504",name:"Harry",password:"123",avatar:"/static/images/Avatar-7.png",email:"Harry@goeasy.io",phone:"138xxxxxxxx",shopId:"shop02"},{id:"4f0b5003-c592-4469-bbe9-22180faffe7c",name:"Lara",password:"123",avatar:"/static/images/Avatar-8.png",email:"Lara@goeasy.io",phone:"138xxxxxxxx",shopId:"shop02"},{id:"f51f6655-be49-4813-87ad-353b9eee971f",name:"Leo",password:"123",avatar:"/static/images/Avatar-9.png",email:"Leo@goeasy.io",phone:"138xxxxxxxx",shopId:"shop03"},{id:"6c751842-545d-4da0-a203-49c31a78d202",name:"Belle",password:"123",avatar:"/static/images/Avatar-10.png",email:"Belle@goeasy.io",phone:"138xxxxxxxx",shopId:"shop03"}]),(0,n.default)(this,"orders",[{id:"252364104325",url:"/static/images/goods1-1.jpg",name:"青桔柠檬气泡美式",price:"￥23",count:1},{id:"251662058022",url:"/static/images/goods1-2.jpg",name:"咸柠七",price:"￥8",count:2},{id:"250676186141",url:"/static/images/goods1-3.jpg",name:"黑糖波波鲜奶茶",price:"￥12",count:1}])}return(0,s.default)(e,[{key:"findShops",value:function(){return this.shops}},{key:"findCustomerById",value:function(e){return this.customers.find((function(t){return t.id===e}))}},{key:"findCustomer",value:function(e,t){return this.customers.find((function(i){return i.name===e&&i.password===t}))}},{key:"findAgents",value:function(){var e=this;return this.agents.forEach((function(t){t.shop=e.findShopById(t.shopId)})),this.agents}},{key:"findShopById",value:function(e){return this.shops.find((function(t){return t.id===e}))}},{key:"findAgent",value:function(e,t){return this.agents.find((function(i){return i.name===e&&i.password===t}))}},{key:"findAgentById",value:function(e){return this.agents.find((function(t){return t.id===e}))}},{key:"getOrderList",value:function(){return this.orders}},{key:"findCustomers",value:function(){return this.customers}}]),e}(),d=new r;t.default=d},e0c8:function(e,t){e.exports="data:image/gif;base64,R0lGODlhEAAQALMMAKqooJGOhp2bk7e1rZ2bkre1rJCPhqqon8PBudDOxXd1bISCef///wAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFAAAMACwAAAAAEAAQAAAET5DJyYyhmAZ7sxQEs1nMsmACGJKmSaVEOLXnK1PuBADepCiMg/DQ+/2GRI8RKOxJfpTCIJNIYArS6aRajWYZCASDa41Ow+Fx2YMWOyfpTAQAIfkEBQAADAAsAAAAABAAEAAABE6QyckEoZgKe7MEQMUxhoEd6FFdQWlOqTq15SlT9VQM3rQsjMKO5/n9hANixgjc9SQ/CgKRUSgw0ynFapVmGYkEg3v1gsPibg8tfk7CnggAIfkEBQAADAAsAAAAABAAEAAABE2QycnOoZjaA/IsRWV1goCBoMiUJTW8A0XMBPZmM4Ug3hQEjN2uZygahDyP0RBMEpmTRCKzWGCkUkq1SsFOFQrG1tr9gsPc3jnco4A9EQAh+QQFAAAMACwAAAAAEAAQAAAETpDJyUqhmFqbJ0LMIA7McWDfF5LmAVApOLUvLFMmlSTdJAiM3a73+wl5HYKSEET2lBSFIhMIYKRSimFriGIZiwWD2/WCw+Jt7xxeU9qZCAAh+QQFAAAMACwAAAAAEAAQAAAETZDJyRCimFqbZ0rVxgwF9n3hSJbeSQ2rCWIkpSjddBzMfee7nQ/XCfJ+OQYAQFksMgQBxumkEKLSCfVpMDCugqyW2w18xZmuwZycdDsRACH5BAUAAAwALAAAAAAQABAAAARNkMnJUqKYWpunUtXGIAj2feFIlt5JrWybkdSydNNQMLaND7pC79YBFnY+HENHMRgyhwPGaQhQotGm00oQMLBSLYPQ9QIASrLAq5x0OxEAIfkEBQAADAAsAAAAABAAEAAABE2QycmUopham+da1cYkCfZ94UiW3kmtbJuRlGF0E4Iwto3rut6tA9wFAjiJjkIgZAYDTLNJgUIpgqyAcTgwCuACJssAdL3gpLmbpLAzEQA7"},f8b0:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAHFSURBVHgB5VftUcMwDFU4BggTkA0IE5Bu0BHCBHSEMgHdIN2AYwJ3g7JBwwTtBkICmaq+xJFN+MW7e+21lvTkLykB+G8oUowRsaGvB2It9DgRe+IbcVcURQ9zgAWJDu3oiBXkgpxL4qsK6IgrYs1jgR0ntyUexPbItpAKzlgFOcgyW/3WKtkXsCIQ3erZZcawiZPh3ovCLxCIr6aMW7+8MAPkPPg9r2KGPsMKZoLa882YgZ9tFwnylHpd5NQfheWQgRPhJhLE6RNrTYBnKz7t0OBXVhMBtLC/ai1MCy8HV1MdApcorBOoI36V2O3595Ua82vfQx4qIl/DwTur6ncZCs+FpcVIC/fyfQN54A71TLwfGlSnme3gOnBk3EE6dsTHiXbo9/+DP35mTE4nCcCH4BZseCcuyHdh6MENnJO8hKow6zFvuY/JLQ9jFVEqDI5WmEyoiuhiRr7C2PtoXFR3qDpmWKK1ldmEncTaWIxrVZGyxGUCnapqtq1T+4KY3o0avHxsMvv6AHUQoBvbJzw/8DmVsMPcQyqHY4uXOErQTriX//R4C3NAEljheHdiMX4UNtXqpDeJMBH47khc8U6zvT38NT4B7i4KZnxWPwoAAAAASUVORK5CYII="}}]);